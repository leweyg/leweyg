<html xmlns:o xmlns:st1>
	<head>
		<title>ESL - MyShader.esl</title></head>
	<body>
		<center>
			<h1>ESL - Extensible Shading Language</h1>
			<a href="http://www.lewcid.com/lg/lc/esl/">Homepage</a> - <a href="http://www.lewcid.com/lg/lc/esl/examples.html">
				Examples</a> - <a href="http://www.lewcid.com/lg/lc/esl/myshader.html">MyShader.esl</a>
		</center>
		<br>
		<hr>
		<h2>MyShader.esl</h2>
		<p>This is an example collection of classes which can be used in the ESL_Designer. 
			It is meant to be a sample moderate sized body of ESL code so that you can see 
			how it works in practice. Keep in mind that the point of the ESL shading 
			language is to provide a easy to read and write language which leans heavily 
			on&nbsp;object-oriented principals&nbsp;and runs about as fast as HLSL, so 
			notice how simple, resusable and focused&nbsp;each class is. While&nbsp;this is 
			not production code, it does give pretty good performance and flexibility (see 
			the <a href="examples.html">examples</a>). Presumably each game team will write 
			their own classes suited specifically to their need; because ESL was designed 
			to be a particularly easy language to write shaders in, this is actually fully 
			practical (looking at the code below I m sure you ll agree).</P>
		<P>A few things to keep in mind: most language conventions follow from C# and HLSL. 
			Properties can only be shader inputs or procedural values, and all are 
			read-only. Properties without arguments can be called and declared without 
			parenthesis.  float Value = XXX;  is equivalent to  float Value() { return XXX; 
			}  and  float Value {return XXX;} . Modifiers are sort of like interfaces 
			except that they can contain code too. If anything in the codes doesn t make 
			sense to you, <a href="ESL.doc">please read the language doc</a>, it covers 
			most of the differences between ESL and standard languages.
		</P>
		<P>For a more hands on approach to exploring the classes, just fire up <a href="http://www.lewcid.com/lg/lc/esl/">
				ESL_Designer</a> which is a friendly interface to creating graphs of these 
			classes.
		</P>
		<P>It should also be kept in mind that the shader graph, once created by the 
			artists (either by exporting from Maya/Max or from the ESL_Designer) is not 
			fixed, and a game engine can modify the graph to suit different needs (i.e. for 
			different passes or LODs, or combine multiple materials into a single shader 
			which implements them all (see  Combed Objects  in the language doc.) ). The 
			graph should be considered the most detailed description of the shader; the 
			engine can then easily strip it down and work with it. Unlike most current 
			generation languages, ESL code is designed to be mutated. .</P>
		<table bgcolor="lightgrey">
			<tr>
				<td>
					<P>Here is the shader code, or download the <a href="myshader.esl">actual file here</a>:</P>



<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//A collection
of ESL classes for demonstration purposes.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>While they are not quite up to production
quality, they<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>are versatile and fast enough to create many
cool effects.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:2'>          </span>-Lewey Geselowitz<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//For more ESL
information, downloads and examples, check out<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>the ESL homepage:
http://www.lewcid.com/lg/lc/esl/<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> MyShader <span
style='color:blue'>adds</span> IMaterial<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;An example base shader material&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float4x4</span>
ProjMatrix : WORLDPROJECTION_MATRIX;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float4x4</span>
ModelViewMatrix : MODELVIEW_MATRIX;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float3</span>
CameraPosition : CAMERA_POS &lt;uitype=&quot;position_world&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float3</span>
CameraDirection : CAMERA_DIR &lt;uitype=&quot;direction_world&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float4</span> RawPosition : POSITION
&lt;uitype=&quot;position_model&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float3</span> RawNormal : NORMAL
&lt;uitype=&quot;direction_model&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor PixelColor<span
style='mso-spacerun:yes'>  </span>&lt;description=&quot;The final pixel
color.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> ModelPosition =
RawPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> Position = <span
style='color:blue'>mul</span>( ModelPosition, ModelViewMatrix );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> ProjectedPosition = <span
style='color:blue'>mul</span>( Position, ProjMatrix );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> ModelNormal = RawNormal;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> <st1:City w:st="on"><st1:place
 w:st="on">Normal</st1:place></st1:City> = <span style='color:blue'>mul</span>(
ModelNormal, <span style='color:blue'>float3x3</span>( ModelViewMatrix ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> DirToCamera =
Position.xyz - CameraPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> UnitDirToCamera = <span
style='color:blue'>normalize</span>( DirToCamera );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> ReflectDir = <span
style='color:blue'>reflect</span>( DirToCamera, <st1:City w:st="on"><st1:place
 w:st="on">Normal</st1:place></st1:City> );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> UnitReflectDir = <span
style='color:blue'>normalize</span>( ReflectDir );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Just an approximation, but good
enough for glass shaders:<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float2</span> ScreenPosition<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float4</span> pos =
ProjectedPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> coord = pos.xy /
pos.w;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> ( coord * <span
style='color:blue'>float2</span>(0.5,-0.5) ) + (0.5).xx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> FinalPosition = ProjectedPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> FinalColor = PixelColor.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> HelloShader <span
style='color:blue'>adds</span> IMaterial<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A very simple shader.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float4x4</span>
ProjMatrix : PROJECTION_MATRIX;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float4</span> RawPosition : POSITION
&lt;uitype=&quot;position_model&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float4</span>
AmbientColor &lt;uitype=&quot;color&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> ProjectedPosition = <span
style='color:blue'>mul</span>( RawPosition, ProjMatrix );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> FinalPosition = ProjectedPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> FinalColor = AmbientColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float4</span> Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FlatColor <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A flat color exposed as a normal shader
constant.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Just a flat user specified color<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>user</span> <span style='color:blue'>float4</span> Color
&lt;uitype=&quot;color&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FixedColor <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A fixed or 'hard-coded' color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>fixed</span> <span style='color:blue'>user</span> <span
style='color:blue'>float4</span> Color &lt;uitype=&quot;color&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> VertexColor <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A per-vertex color (a vertex
attribute)&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>user</span> <span style='color:blue'>attrib</span> <span
style='color:blue'>float4</span> Color &lt;uitype=&quot;color&quot;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>default</span>=&quot;COLOR0&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float2</span> Transform(<span
style='color:blue'>float2</span> uv) = uv;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
ITexture <span style='color:blue'>adds</span> UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Transforms the coordinate using a
UVTransform and then samples the texture.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This property should be overriden,
the coord passed in has already<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>been
transformed.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>protected</span> <span style='color:blue'>float4</span>
BaseSample(<span style='color:blue'>float2</span> coord);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This transforms the UV and then
samples the texture, this cannot<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>be
overriden.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>sealed</span> <span style='color:blue'>float4</span>
Sample(<span style='color:blue'>float2</span> coord) = BaseSample(
Transform(coord) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> RealTexture <span
style='color:blue'>adds</span> ITexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Actually samples a texture.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This declares an actual texture:<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>protected</span> <span style='color:blue'>texture</span> <span
style='color:blue'>float4</span> BaseSample(<span style='color:blue'>float2</span>
coord) <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;name=&quot;Texture&quot; <span style='color:blue'>default</span>=&quot;TEXTURE0&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ColorTexture <span
style='color:blue'>adds</span> ITexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Lets you use a color as a texture,
presumably for blending purposes.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor SolidColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>protected</span> <span style='color:blue'>float4</span>
BaseSample(<span style='color:blue'>float2</span> coord) = SolidColor.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> TexturedColor <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Samples a texture to generate this
color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ITexture Tex
&lt;name=&quot;Texture&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue2 TexCoord;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = Tex.Sample( TexCoord.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
IValue2 <span style='color:blue'>adds</span> UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This property should be overriden
to get the underlying value.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>protected</span> <span style='color:blue'>float2</span>
BaseValue;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This transforms the BaseValue and
cannot be overriden.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>sealed</span> <span style='color:blue'>float2</span>
Value = Transform( BaseValue );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> UVCoords <span
style='color:blue'>adds</span> IValue2<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A per-vertex UV coordinate.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>protected</span> <span style='color:blue'>user</span> <span
style='color:blue'>attrib</span> <span style='color:blue'>float2</span>
BaseValue <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;name=&quot;UVCoord&quot; <span style='color:blue'>default</span>=&quot;TEXCOORD0&quot;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>description=&quot;Select a 'channel' (like TEXCOORD0) to
feed this value.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ScreenXY <span
style='color:blue'>adds</span> IValue2 <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Returns the current screen XY
coordinate&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float2</span> BaseValue = MyShader.ScreenPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
ILight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float3</span> Direction;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float4</span> Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Each light can optionally change
the range of factors<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>it
can contribute. This should be called by any code<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>which
uses this light.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float</span> ClipFactor(<span
style='color:blue'>float</span> f) = <span style='color:blue'>max</span>( 0, f
);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This assumes for now that Direction
is already normalized.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> UnitDirection =
Direction;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> DiffuseLighting <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Does diffuse lighting calculations to
generate this color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor DiffuseColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> ILight[] DiffuseLights <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;description=&quot;The lights which will affect the
diffuse color.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float</span> LightFactor(ILight el) <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>= el.ClipFactor( <span style='color:blue'>dot</span>(
MyShader.Normal, el.UnitDirection ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> DiffuseFromLight(ILight
el)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>= el.Color * LightFactor( el );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float4</span> light = <span
style='color:blue'>sumeach</span>( <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>DiffuseFromLight(<span style='color:blue'>value</span>)
<span style='color:blue'>in</span> DiffuseLights );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> DiffuseColor.Color
* light;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FocusLight <span
style='color:blue'>extends</span> ILight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Allows you to adjust the min and max
lighting factor.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue MinFactor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue MaxFactor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float</span> ClipFactor(<span style='color:blue'>float</span>
f)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> <span
style='color:blue'>smoothstep</span>( MinFactor.Value, MaxFactor.Value, f );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> DirectionalLight <span
style='color:blue'>adds</span> ILight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A directional light, has a color and
direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
LightDirection &lt;uitype=&quot;direction_world&quot; <span style='color:blue'>default</span>=&quot;LIGHT_0_DIR&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor LightColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> Direction = LightDirection;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = LightColor.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> PointLight <span
style='color:blue'>adds</span> ILight <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A point light, has a color and
position.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
Position &lt;uitype=&quot;position_world&quot; <span style='color:blue'>default</span>=&quot;LIGHT_0_POS&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor LightColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Use the current vertex position to
calculate the light<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>direction.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> Direction = Position - MyShader.Position.xyz;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> UnitDirection = <span style='color:blue'>normalize</span>(
Direction );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = LightColor.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> PerPixelNormalizeDirection <span
style='color:blue'>extends</span> PointLight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Makes sure the point light direction is
per-pixel normalized&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>pshader</span> <span style='color:blue'>float3</span>
UnitDirection = <span style='color:blue'>normalize</span>( Direction );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ProjectedTextureLight <span
style='color:blue'>adds</span> ILight, UVTransform <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Projects a texture from a light source in
a direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
Position &lt;uitype=&quot;position_world&quot; <span style='color:blue'>default</span>=&quot;light_0_pos&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
LightDirection &lt;uitype=&quot;direction_world&quot; <span style='color:blue'>default</span>=&quot;light_0_dir&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>fixed</span> <span style='color:blue'>user</span>
<span style='color:blue'>float</span> UVScale &lt;<span style='color:blue'>default</span>=&quot;1&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ITexture Tex;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> Direction = Position - MyShader.Position.xyz;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> UnitDirection = <span style='color:blue'>normalize</span>(
Direction );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> Up = <span
style='color:blue'>float3</span>( 0, 1, 0 );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> ZAxis = LightDirection;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> XAxis = <span
style='color:blue'>cross</span>( ZAxis, Up );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> YAxis = <span
style='color:blue'>cross</span>( ZAxis, XAxis );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float2</span> RawXYCoord<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> dxy = <span
style='color:blue'>float2</span>(<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span><span style='color:blue'>dot</span>( Direction,
XAxis ),<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span><span style='color:blue'>dot</span>( Direction,
YAxis ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> coord = dxy / <span
style='color:blue'>dot</span>( Direction, ZAxis );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> ( coord * UVScale
) + (0.5).xx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float2</span> BaseTexCoord = <span
style='color:blue'>saturate</span>( RawXYCoord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>sealed</span> <span style='color:blue'>float2</span>
TexCoord = Transform( BaseTexCoord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = Tex.Sample( TexCoord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> SpecularLighting <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Does specular lighting calculations to
generate a color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>fixed</span> <span style='color:blue'>user</span>
<span style='color:blue'>float</span> SpecularPower<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;description=&quot;The power to which the specular
component is raised.&quot; <span style='color:blue'>default</span>=&quot;32&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> ILight[] SpecularLights;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor SpecularColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> SpecularDir =
MyShader.UnitReflectDir;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> SpecularFromLight(ILight
el)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float</span> f = el.ClipFactor( <span
style='color:blue'>dot</span>( SpecularDir, el.UnitDirection ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> el.Color * <span
style='color:blue'>saturate</span>( <span style='color:blue'>pow</span>( <span
style='color:blue'>max</span>( 0, f ), SpecularPower ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = SpecularColor.Color * <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>sumeach</span>(
SpecularFromLight(<span style='color:blue'>value</span>) <span
style='color:blue'>in</span> SpecularLights );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> PerPixelNormals <span
style='color:blue'>extends</span> MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Normalizes the normal in the pixel
shader, implicitly pushing most lighting code into the pixel shader.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>pshader</span> <span style='color:
blue'>override</span> <span style='color:blue'>float3</span> Normal = <span
style='color:blue'>normalize</span>( <span style='color:blue'>base</span>.Normal
);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> GrayScale <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Applies a grey-scale filter to a
color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float4</span> c = <span
style='color:blue'>base</span>.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float</span> v = ((c.r + c.g +
c.b)/3);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> <span
style='color:blue'>float4</span>( v, v, v, c.a );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//Not the most
powerful bump-mapper but works well for simple<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>situations.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> NormalMap <span
style='color:blue'>extends</span> MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Adds bump-mapping&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> TexturedColor BumpMap
&lt;description=&quot;The bump-map texture&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float3</span> TangentU &lt;<span style='color:blue'>default</span>=&quot;TEXCOORD1&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float3</span> TangentV &lt;<span style='color:blue'>default</span>=&quot;TEXCOORD2&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue NormalWeight
&lt;description=&quot;Weights the bump-map in the vertex-normal direction if
below 1.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> BumpBase = (
BumpMap.Color.xyz * 2 ) - (1).xxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> BumpDir<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float3</span> bumpuv = ( <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>( TangentU * BumpBase.x ) +<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>( TangentV * BumpBase.y ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> <span
style='color:blue'>normalize</span>( <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>( bumpuv * NormalWeight.Value ) +<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>( RawNormal * BumpBase.z ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> ModelNormal = BumpDir;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> NegOneOneToZeroOne <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Shift a color from a [-1,1] span to the
[0,1] span.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = ( <span style='color:blue'>base</span>.Color
+ (1).xxxx ) * 0.5;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ZeroOneToNegOneOne <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Shift a color from a [0,1] span to the
[-1,1] span.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = ( <span style='color:blue'>base</span>.Color
* 2 ) - (1).xxxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ClampColor <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Clamps the color to the [0,1]
range.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>clamp</span>(
<span style='color:blue'>base</span>.Color, (0).xxxx, (1).xxxx );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> NormalizeColor <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Normalizes the xyz and sets the alpha to
0.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>normalize</span>(
<span style='color:blue'>base</span>.Color.xyz ).xyz0;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> InvertColor <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Does a 1 minus the color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = (1).xxxx - <span style='color:blue'>base</span>.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> NegativeColor <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Multiplies the color by a negative
1.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = -<span style='color:blue'>base</span>.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> SumColors <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Lets you specify a number of IColor(s)
and then just adds them all up.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor[] Colors;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>sumeach</span>(
<span style='color:blue'>value</span>.Color <span style='color:blue'>in</span>
Colors );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float</span> Value;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FlatValue <span
style='color:blue'>adds</span> IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Create a shader constant to hold a single
float.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>user</span> <span style='color:blue'>float</span> Value;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FixedValue <span
style='color:blue'>adds</span> IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Creates a fixed or 'hard coded' float
value.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>fixed</span> <span style='color:blue'>user</span> <span
style='color:blue'>float</span> Value;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> CroppedUV <span
style='color:blue'>extends</span> UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Crops the UV coordinates to [0,1], can
then applies a scale and offset. Used to simuate a full texture as a subrect of
another texture.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue UOffset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue VOffset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue UWidth;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue VWidth;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Has to be done on a per-pixel
basis:<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>pshader</span> <span style='color:blue'>float2</span>
Transform(<span style='color:blue'>float2</span> coord)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> offset = <span
style='color:blue'>float2</span>( UOffset.Value, VOffset.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> width = <span
style='color:blue'>float2</span>( UWidth.Value, VWidth.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> uv = <span
style='color:blue'>base</span>.Transform( coord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> ( <span
style='color:blue'>fmod</span>( uv, (1).xx ) * width ) + offset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ScaledUV <span
style='color:blue'>extends</span> UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Lets you scale the UV coordinates and add
an offset.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue UScale;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue VScale;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue UOffset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue VOffset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float2</span> Transform(<span style='color:blue'>float2</span>
coord)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> scale = <span
style='color:blue'>float2</span>( UScale.Value, VScale.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> offset = <span
style='color:blue'>float2</span>( UOffset.Value, VOffset.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> ( <span
style='color:blue'>base</span>.Transform( coord ) * scale ) + offset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> AddRefraction <span
style='color:blue'>extends</span> UVTransform <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Adds an offset in the refraction
direction. Good for something like glass. Should be used over
ScreenXY.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue RefractionScaler
&lt;description=&quot;How much the UV coordinate is changed&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue RefractionIndex
&lt;description=&quot;How much the light bends, default is 2.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> RefractDir = <span
style='color:blue'>refract</span>( <span style='color:blue'>normalize</span>(MyShader.DirToCamera),
<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>MyShader.Normal, RefractionIndex.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> UnitRefractDir = (
RefractDir );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float2</span> Transform(<span style='color:blue'>float2</span>
coord)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> delta =
UnitRefractDir.xy * RefractionScaler.Value;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> <span
style='color:blue'>base</span>.Transform( coord ) + delta;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
ICubicTexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float4</span> Sample(<span style='color:blue'>float3</span>
coord);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> OppositeDirection <span
style='color:blue'>extends</span> ICubicTexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Samples the cubic texture in the opposite
direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Sample(<span style='color:blue'>float3</span>
coord) = <span style='color:blue'>base</span>.Sample( -coord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> RealCubicTexture <span
style='color:blue'>adds</span> ICubicTexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A cubic (CUBE) texture.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>CUBE</span> <span style='color:blue'>texture</span> <span
style='color:blue'>float4</span> Sample(<span style='color:blue'>float3</span>
coord) <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;<span style='color:blue'>default</span>=&quot;CUBETEXTURE0&quot;
name=&quot;Cubic Texture&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ReflectionColor <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Uses an environment map to calculate the
reflected color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ICubicTexture EnvMap
&lt;description=&quot;The environment map to use for reflection.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = EnvMap.Sample( MyShader.ReflectDir );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> UseNormalDirection <span
style='color:blue'>extends</span> ReflectionColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Uses the normal direction instead of
reflection direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = EnvMap.Sample( MyShader.Normal );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//Dots the
Normal direction with the camera direction, and uses that<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>value to blend between the two colors in the
given span.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ReflectiveTwoTone <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Blends between two colors based on angle
of the normal to the eye.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue BlendStart
&lt;description=&quot;Angles lower than this are fully LowColor.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue BlendEnd
&lt;description=&quot;Angles higher than this are fully HighColor.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor LowColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor HighColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float</span> ReflectFactor = <span
style='color:blue'>dot</span>( MyShader.Normal, -MyShader.UnitDirToCamera );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float</span> BlendFactor = <span
style='color:blue'>smoothstep</span>( BlendStart.Value, BlendEnd.Value, <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>ReflectFactor );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>lerp</span>(
LowColor.Color, HighColor.Color, <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>BlendFactor.xxxx );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> UseNormalDirection <span
style='color:blue'>extends</span> ReflectiveTwoTone <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Does a reflective blend using the
reflection direction instead of the normal direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float</span> ReflectFactor <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>= <span style='color:blue'>dot</span>(
MyShader.UnitReflectDir, MyShader.UnitDirToCamera );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> One <span style='color:
blue'>adds</span> IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A hard-coded 1&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float</span> Value = 1;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Zero <span
style='color:blue'>adds</span> IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A hard-coded 0&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float</span> Value = 0;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Black <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;The hard-coded color black,
(0,0,0,0)&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = (0).xxxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> White <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;The hard-coded color white,
(1,1,1,1)&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = (1).xxxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
IColorCombiner<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> Combine(<span
style='color:blue'>float4</span> a, <span style='color:blue'>float4</span> b) =
a * b;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> CombinedTexture <span
style='color:blue'>adds</span> IColorCombiner, ITexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Combines two textures (feel free to stack
these). Multiplies them by default, modifiers can be added to change
this.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ITexture First;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ITexture Second;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> BaseSample(<span style='color:blue'>float2</span>
coord)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>= Combine( First.Sample(coord), Second.Sample( coord ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> CombinedColor <span
style='color:blue'>adds</span> IColorCombiner, IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Combines two colors (feel free to stack
these). Multiplies them by default, modifiers can be added to change
this.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor First;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor Second;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = Combine( First.Color, Second.Color );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> AdditiveCombine <span
style='color:blue'>extends</span> IColorCombiner<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Changes a combiner into an additive
combiner i.e. First + Second.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Combine(<span style='color:blue'>float4</span>
a, <span style='color:blue'>float4</span> b) = a + b;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//These classes
are used for testing, and can be quite handy:<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_FlatLights <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Just adds the lights colors, ignores
thier directions.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> ILight[] ColoredLights;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> LightContrib(ILight el)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float</span> f = el.ClipFactor(
1 );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> el.Color * f;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>sumeach</span>(
LightContrib(<span style='color:blue'>value</span>) <span style='color:blue'>in</span>
ColoredLights );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_ViewNormal <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Visualizes the normal as a color.
Reverses the Z direction for convenience.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = ( MyShader.Normal * <span
style='color:blue'>float3</span>(1,1,-1) ).xyz0;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_ViewTexCoords <span
style='color:blue'>adds</span> ITexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Outputs the texture coordinates as a
color so that you can easily visualize them.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>protected</span> <span style='color:blue'>float4</span>
BaseSample(<span style='color:blue'>float2</span> coord) = <span
style='color:blue'>frac</span>( coord ).xy00;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_EasyLight <span
style='color:blue'>adds</span> ILight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A directional white light in the
'LIGHT_0_DIR' direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
LightDirection : LIGHT_0_DIR;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> Direction = LightDirection;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = (1).xxxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_ViewCubicCoords <span
style='color:blue'>adds</span> ICubicTexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Outputs the texture coordinates as a
color so that you can easily visualize them.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Sample(<span style='color:blue'>float3</span>
coord) = <span style='color:blue'>normalize</span>(coord).xyz0;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//Don't use
this:<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>/*<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><span
style='mso-tab-count:1'>      </span>NOTE: Using this modifier, and setting
NewPosition to a UVCoord<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><span
style='mso-tab-count:1'>      </span>created a valid shader but made the driver
go crazy.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>modifier
Test_CoordToPosition extends MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><span
style='mso-tab-count:1'>      </span>user IValue2 NewPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><span
style='mso-tab-count:1'>      </span>override float4 FinalPosition =
NewPosition.Value.xy01;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New";
color:green'>*/</span><br/>


				</td>
			</tr>
		</table>
		<P>&nbsp;<br/>
		<P>&nbsp;<br/>
		<P>Copyright 2006 Lewey Geselowitz<br/>
	</body>
</html>
<!-- text below generated by server. PLEASE REMOVE --><!-- Counter/Statistics data collection code --><script language="JavaScript" src="http://l.yimg.com/d/lib/smb/js/hosting/cp/js_source/whv2_001.js"></script><script language="javascript">geovisit();</script><noscript><img src="http://visit.webhosting.yahoo.com/visit.gif?us1378800244" alt="setstats" border="0" width="1" height="1"></noscript>
<html xmlns:o xmlns:st1>
	<head>
		<title>ESL - MyShader.esl</title></head>
	<body>
		<center>
			<h1>ESL - Extensible Shading Language</h1>
			<a href="http://www.lewcid.com/lg/lc/esl/">Homepage</a> - <a href="http://www.lewcid.com/lg/lc/esl/examples.html">
				Examples</a> - <a href="http://www.lewcid.com/lg/lc/esl/myshader.html">MyShader.esl</a>
		</center>
		<br>
		<hr>
		<h2>MyShader.esl</h2>
		<p>This is an example collection of classes which can be used in the ESL_Designer. 
			It is meant to be a sample moderate sized body of ESL code so that you can see 
			how it works in practice. Keep in mind that the point of the ESL shading 
			language is to provide a easy to read and write language which leans heavily 
			on&nbsp;object-oriented principals&nbsp;and runs about as fast as HLSL, so 
			notice how simple, resusable and focused&nbsp;each class is. While&nbsp;this is 
			not production code, it does give pretty good performance and flexibility (see 
			the <a href="examples.html">examples</a>). Presumably each game team will write 
			their own classes suited specifically to their need; because ESL was designed 
			to be a particularly easy language to write shaders in, this is actually fully 
			practical (looking at the code below I m sure you ll agree).</P>
		<P>A few things to keep in mind: most language conventions follow from C# and HLSL. 
			Properties can only be shader inputs or procedural values, and all are 
			read-only. Properties without arguments can be called and declared without 
			parenthesis.  float Value = XXX;  is equivalent to  float Value() { return XXX; 
			}  and  float Value {return XXX;} . Modifiers are sort of like interfaces 
			except that they can contain code too. If anything in the codes doesn t make 
			sense to you, <a href="ESL.doc">please read the language doc</a>, it covers 
			most of the differences between ESL and standard languages.
		</P>
		<P>For a more hands on approach to exploring the classes, just fire up <a href="http://www.lewcid.com/lg/lc/esl/">
				ESL_Designer</a> which is a friendly interface to creating graphs of these 
			classes.
		</P>
		<P>It should also be kept in mind that the shader graph, once created by the 
			artists (either by exporting from Maya/Max or from the ESL_Designer) is not 
			fixed, and a game engine can modify the graph to suit different needs (i.e. for 
			different passes or LODs, or combine multiple materials into a single shader 
			which implements them all (see  Combed Objects  in the language doc.) ). The 
			graph should be considered the most detailed description of the shader; the 
			engine can then easily strip it down and work with it. Unlike most current 
			generation languages, ESL code is designed to be mutated. .</P>
		<table bgcolor="lightgrey">
			<tr>
				<td>
					<P>Here is the shader code, or download the <a href="myshader.esl">actual file here</a>:</P>



<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//A collection
of ESL classes for demonstration purposes.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>While they are not quite up to production
quality, they<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>are versatile and fast enough to create many
cool effects.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:2'>          </span>-Lewey Geselowitz<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//For more ESL
information, downloads and examples, check out<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>the ESL homepage:
http://www.lewcid.com/lg/lc/esl/<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> MyShader <span
style='color:blue'>adds</span> IMaterial<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;An example base shader material&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float4x4</span>
ProjMatrix : WORLDPROJECTION_MATRIX;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float4x4</span>
ModelViewMatrix : MODELVIEW_MATRIX;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float3</span>
CameraPosition : CAMERA_POS &lt;uitype=&quot;position_world&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float3</span>
CameraDirection : CAMERA_DIR &lt;uitype=&quot;direction_world&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float4</span> RawPosition : POSITION
&lt;uitype=&quot;position_model&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float3</span> RawNormal : NORMAL
&lt;uitype=&quot;direction_model&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor PixelColor<span
style='mso-spacerun:yes'>  </span>&lt;description=&quot;The final pixel
color.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> ModelPosition =
RawPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> Position = <span
style='color:blue'>mul</span>( ModelPosition, ModelViewMatrix );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> ProjectedPosition = <span
style='color:blue'>mul</span>( Position, ProjMatrix );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> ModelNormal = RawNormal;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> <st1:City w:st="on"><st1:place
 w:st="on">Normal</st1:place></st1:City> = <span style='color:blue'>mul</span>(
ModelNormal, <span style='color:blue'>float3x3</span>( ModelViewMatrix ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> DirToCamera =
Position.xyz - CameraPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> UnitDirToCamera = <span
style='color:blue'>normalize</span>( DirToCamera );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> ReflectDir = <span
style='color:blue'>reflect</span>( DirToCamera, <st1:City w:st="on"><st1:place
 w:st="on">Normal</st1:place></st1:City> );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> UnitReflectDir = <span
style='color:blue'>normalize</span>( ReflectDir );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Just an approximation, but good
enough for glass shaders:<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float2</span> ScreenPosition<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float4</span> pos =
ProjectedPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> coord = pos.xy /
pos.w;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> ( coord * <span
style='color:blue'>float2</span>(0.5,-0.5) ) + (0.5).xx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> FinalPosition = ProjectedPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> FinalColor = PixelColor.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> HelloShader <span
style='color:blue'>adds</span> IMaterial<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A very simple shader.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> <span style='color:blue'>float4x4</span>
ProjMatrix : PROJECTION_MATRIX;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float4</span> RawPosition : POSITION
&lt;uitype=&quot;position_model&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float4</span>
AmbientColor &lt;uitype=&quot;color&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> ProjectedPosition = <span
style='color:blue'>mul</span>( RawPosition, ProjMatrix );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> FinalPosition = ProjectedPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> FinalColor = AmbientColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float4</span> Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FlatColor <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A flat color exposed as a normal shader
constant.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Just a flat user specified color<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>user</span> <span style='color:blue'>float4</span> Color
&lt;uitype=&quot;color&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FixedColor <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A fixed or 'hard-coded' color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>fixed</span> <span style='color:blue'>user</span> <span
style='color:blue'>float4</span> Color &lt;uitype=&quot;color&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> VertexColor <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A per-vertex color (a vertex
attribute)&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>user</span> <span style='color:blue'>attrib</span> <span
style='color:blue'>float4</span> Color &lt;uitype=&quot;color&quot;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>default</span>=&quot;COLOR0&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float2</span> Transform(<span
style='color:blue'>float2</span> uv) = uv;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
ITexture <span style='color:blue'>adds</span> UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Transforms the coordinate using a
UVTransform and then samples the texture.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This property should be overriden,
the coord passed in has already<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>been
transformed.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>protected</span> <span style='color:blue'>float4</span>
BaseSample(<span style='color:blue'>float2</span> coord);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This transforms the UV and then
samples the texture, this cannot<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>be
overriden.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>sealed</span> <span style='color:blue'>float4</span>
Sample(<span style='color:blue'>float2</span> coord) = BaseSample(
Transform(coord) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> RealTexture <span
style='color:blue'>adds</span> ITexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Actually samples a texture.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This declares an actual texture:<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>protected</span> <span style='color:blue'>texture</span> <span
style='color:blue'>float4</span> BaseSample(<span style='color:blue'>float2</span>
coord) <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;name=&quot;Texture&quot; <span style='color:blue'>default</span>=&quot;TEXTURE0&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ColorTexture <span
style='color:blue'>adds</span> ITexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Lets you use a color as a texture,
presumably for blending purposes.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor SolidColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>protected</span> <span style='color:blue'>float4</span>
BaseSample(<span style='color:blue'>float2</span> coord) = SolidColor.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> TexturedColor <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Samples a texture to generate this
color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ITexture Tex
&lt;name=&quot;Texture&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue2 TexCoord;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = Tex.Sample( TexCoord.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
IValue2 <span style='color:blue'>adds</span> UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This property should be overriden
to get the underlying value.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>protected</span> <span style='color:blue'>float2</span>
BaseValue;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This transforms the BaseValue and
cannot be overriden.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>sealed</span> <span style='color:blue'>float2</span>
Value = Transform( BaseValue );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> UVCoords <span
style='color:blue'>adds</span> IValue2<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A per-vertex UV coordinate.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>protected</span> <span style='color:blue'>user</span> <span
style='color:blue'>attrib</span> <span style='color:blue'>float2</span>
BaseValue <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;name=&quot;UVCoord&quot; <span style='color:blue'>default</span>=&quot;TEXCOORD0&quot;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>description=&quot;Select a 'channel' (like TEXCOORD0) to
feed this value.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ScreenXY <span
style='color:blue'>adds</span> IValue2 <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Returns the current screen XY
coordinate&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float2</span> BaseValue = MyShader.ScreenPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
ILight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float3</span> Direction;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float4</span> Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Each light can optionally change
the range of factors<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>it
can contribute. This should be called by any code<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>which
uses this light.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float</span> ClipFactor(<span
style='color:blue'>float</span> f) = <span style='color:blue'>max</span>( 0, f
);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//This assumes for now that Direction
is already normalized.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> UnitDirection =
Direction;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> DiffuseLighting <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Does diffuse lighting calculations to
generate this color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor DiffuseColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> ILight[] DiffuseLights <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;description=&quot;The lights which will affect the
diffuse color.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float</span> LightFactor(ILight el) <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>= el.ClipFactor( <span style='color:blue'>dot</span>(
MyShader.Normal, el.UnitDirection ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> DiffuseFromLight(ILight
el)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>= el.Color * LightFactor( el );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float4</span> light = <span
style='color:blue'>sumeach</span>( <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>DiffuseFromLight(<span style='color:blue'>value</span>)
<span style='color:blue'>in</span> DiffuseLights );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> DiffuseColor.Color
* light;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FocusLight <span
style='color:blue'>extends</span> ILight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Allows you to adjust the min and max
lighting factor.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue MinFactor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue MaxFactor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float</span> ClipFactor(<span style='color:blue'>float</span>
f)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> <span
style='color:blue'>smoothstep</span>( MinFactor.Value, MaxFactor.Value, f );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> DirectionalLight <span
style='color:blue'>adds</span> ILight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A directional light, has a color and
direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
LightDirection &lt;uitype=&quot;direction_world&quot; <span style='color:blue'>default</span>=&quot;LIGHT_0_DIR&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor LightColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> Direction = LightDirection;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = LightColor.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> PointLight <span
style='color:blue'>adds</span> ILight <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A point light, has a color and
position.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
Position &lt;uitype=&quot;position_world&quot; <span style='color:blue'>default</span>=&quot;LIGHT_0_POS&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor LightColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Use the current vertex position to
calculate the light<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//<span style='mso-tab-count:1'>    </span>direction.<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> Direction = Position - MyShader.Position.xyz;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> UnitDirection = <span style='color:blue'>normalize</span>(
Direction );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = LightColor.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> PerPixelNormalizeDirection <span
style='color:blue'>extends</span> PointLight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Makes sure the point light direction is
per-pixel normalized&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>pshader</span> <span style='color:blue'>float3</span>
UnitDirection = <span style='color:blue'>normalize</span>( Direction );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ProjectedTextureLight <span
style='color:blue'>adds</span> ILight, UVTransform <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Projects a texture from a light source in
a direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
Position &lt;uitype=&quot;position_world&quot; <span style='color:blue'>default</span>=&quot;light_0_pos&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
LightDirection &lt;uitype=&quot;direction_world&quot; <span style='color:blue'>default</span>=&quot;light_0_dir&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>fixed</span> <span style='color:blue'>user</span>
<span style='color:blue'>float</span> UVScale &lt;<span style='color:blue'>default</span>=&quot;1&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ITexture Tex;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> Direction = Position - MyShader.Position.xyz;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> UnitDirection = <span style='color:blue'>normalize</span>(
Direction );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> Up = <span
style='color:blue'>float3</span>( 0, 1, 0 );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> ZAxis = LightDirection;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> XAxis = <span
style='color:blue'>cross</span>( ZAxis, Up );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> YAxis = <span
style='color:blue'>cross</span>( ZAxis, XAxis );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float2</span> RawXYCoord<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> dxy = <span
style='color:blue'>float2</span>(<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span><span style='color:blue'>dot</span>( Direction,
XAxis ),<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span><span style='color:blue'>dot</span>( Direction,
YAxis ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> coord = dxy / <span
style='color:blue'>dot</span>( Direction, ZAxis );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> ( coord * UVScale
) + (0.5).xx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float2</span> BaseTexCoord = <span
style='color:blue'>saturate</span>( RawXYCoord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>sealed</span> <span style='color:blue'>float2</span>
TexCoord = Transform( BaseTexCoord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = Tex.Sample( TexCoord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> SpecularLighting <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Does specular lighting calculations to
generate a color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>fixed</span> <span style='color:blue'>user</span>
<span style='color:blue'>float</span> SpecularPower<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;description=&quot;The power to which the specular
component is raised.&quot; <span style='color:blue'>default</span>=&quot;32&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> ILight[] SpecularLights;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor SpecularColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> SpecularDir =
MyShader.UnitReflectDir;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> SpecularFromLight(ILight
el)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float</span> f = el.ClipFactor( <span
style='color:blue'>dot</span>( SpecularDir, el.UnitDirection ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> el.Color * <span
style='color:blue'>saturate</span>( <span style='color:blue'>pow</span>( <span
style='color:blue'>max</span>( 0, f ), SpecularPower ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = SpecularColor.Color * <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>sumeach</span>(
SpecularFromLight(<span style='color:blue'>value</span>) <span
style='color:blue'>in</span> SpecularLights );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> PerPixelNormals <span
style='color:blue'>extends</span> MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Normalizes the normal in the pixel
shader, implicitly pushing most lighting code into the pixel shader.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>pshader</span> <span style='color:
blue'>override</span> <span style='color:blue'>float3</span> Normal = <span
style='color:blue'>normalize</span>( <span style='color:blue'>base</span>.Normal
);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> GrayScale <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Applies a grey-scale filter to a
color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float4</span> c = <span
style='color:blue'>base</span>.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float</span> v = ((c.r + c.g +
c.b)/3);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> <span
style='color:blue'>float4</span>( v, v, v, c.a );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//Not the most
powerful bump-mapper but works well for simple<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>situations.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> NormalMap <span
style='color:blue'>extends</span> MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Adds bump-mapping&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> TexturedColor BumpMap
&lt;description=&quot;The bump-map texture&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float3</span> TangentU &lt;<span style='color:blue'>default</span>=&quot;TEXCOORD1&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>attrib</span>
<span style='color:blue'>float3</span> TangentV &lt;<span style='color:blue'>default</span>=&quot;TEXCOORD2&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue NormalWeight
&lt;description=&quot;Weights the bump-map in the vertex-normal direction if
below 1.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> BumpBase = (
BumpMap.Color.xyz * 2 ) - (1).xxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> BumpDir<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float3</span> bumpuv = ( <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>( TangentU * BumpBase.x ) +<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>( TangentV * BumpBase.y ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> <span
style='color:blue'>normalize</span>( <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>( bumpuv * NormalWeight.Value ) +<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
3'>                  </span>( RawNormal * BumpBase.z ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> ModelNormal = BumpDir;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> NegOneOneToZeroOne <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Shift a color from a [-1,1] span to the
[0,1] span.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = ( <span style='color:blue'>base</span>.Color
+ (1).xxxx ) * 0.5;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ZeroOneToNegOneOne <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Shift a color from a [0,1] span to the
[-1,1] span.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = ( <span style='color:blue'>base</span>.Color
* 2 ) - (1).xxxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ClampColor <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Clamps the color to the [0,1]
range.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>clamp</span>(
<span style='color:blue'>base</span>.Color, (0).xxxx, (1).xxxx );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> NormalizeColor <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Normalizes the xyz and sets the alpha to
0.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>normalize</span>(
<span style='color:blue'>base</span>.Color.xyz ).xyz0;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> InvertColor <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Does a 1 minus the color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = (1).xxxx - <span style='color:blue'>base</span>.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> NegativeColor <span
style='color:blue'>extends</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Multiplies the color by a negative
1.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = -<span style='color:blue'>base</span>.Color;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> SumColors <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Lets you specify a number of IColor(s)
and then just adds them all up.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor[] Colors;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>sumeach</span>(
<span style='color:blue'>value</span>.Color <span style='color:blue'>in</span>
Colors );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float</span> Value;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FlatValue <span
style='color:blue'>adds</span> IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Create a shader constant to hold a single
float.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>user</span> <span style='color:blue'>float</span> Value;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> FixedValue <span
style='color:blue'>adds</span> IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Creates a fixed or 'hard coded' float
value.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>fixed</span> <span style='color:blue'>user</span> <span
style='color:blue'>float</span> Value;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> CroppedUV <span
style='color:blue'>extends</span> UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Crops the UV coordinates to [0,1], can
then applies a scale and offset. Used to simuate a full texture as a subrect of
another texture.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue UOffset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue VOffset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue UWidth;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue VWidth;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:green'>//Has to be done on a per-pixel
basis:<o:p></o:p></span></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>pshader</span> <span style='color:blue'>float2</span>
Transform(<span style='color:blue'>float2</span> coord)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> offset = <span
style='color:blue'>float2</span>( UOffset.Value, VOffset.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> width = <span
style='color:blue'>float2</span>( UWidth.Value, VWidth.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> uv = <span
style='color:blue'>base</span>.Transform( coord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> ( <span
style='color:blue'>fmod</span>( uv, (1).xx ) * width ) + offset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ScaledUV <span
style='color:blue'>extends</span> UVTransform<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Lets you scale the UV coordinates and add
an offset.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue UScale;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue VScale;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue UOffset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue VOffset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float2</span> Transform(<span style='color:blue'>float2</span>
coord)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> scale = <span
style='color:blue'>float2</span>( UScale.Value, VScale.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> offset = <span
style='color:blue'>float2</span>( UOffset.Value, VOffset.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> ( <span
style='color:blue'>base</span>.Transform( coord ) * scale ) + offset;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> AddRefraction <span
style='color:blue'>extends</span> UVTransform <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Adds an offset in the refraction
direction. Good for something like glass. Should be used over
ScreenXY.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue RefractionScaler
&lt;description=&quot;How much the UV coordinate is changed&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue RefractionIndex
&lt;description=&quot;How much the light bends, default is 2.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> RefractDir = <span
style='color:blue'>refract</span>( <span style='color:blue'>normalize</span>(MyShader.DirToCamera),
<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>MyShader.Normal, RefractionIndex.Value );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float3</span> UnitRefractDir = (
RefractDir );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float2</span> Transform(<span style='color:blue'>float2</span>
coord)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float2</span> delta =
UnitRefractDir.xy * RefractionScaler.Value;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> <span
style='color:blue'>base</span>.Transform( coord ) + delta;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
ICubicTexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>abstract</span> <span
style='color:blue'>float4</span> Sample(<span style='color:blue'>float3</span>
coord);<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> OppositeDirection <span
style='color:blue'>extends</span> ICubicTexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Samples the cubic texture in the opposite
direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Sample(<span style='color:blue'>float3</span>
coord) = <span style='color:blue'>base</span>.Sample( -coord );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> RealCubicTexture <span
style='color:blue'>adds</span> ICubicTexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A cubic (CUBE) texture.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>CUBE</span> <span style='color:blue'>texture</span> <span
style='color:blue'>float4</span> Sample(<span style='color:blue'>float3</span>
coord) <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>&lt;<span style='color:blue'>default</span>=&quot;CUBETEXTURE0&quot;
name=&quot;Cubic Texture&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ReflectionColor <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Uses an environment map to calculate the
reflected color.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ICubicTexture EnvMap
&lt;description=&quot;The environment map to use for reflection.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = EnvMap.Sample( MyShader.ReflectDir );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> UseNormalDirection <span
style='color:blue'>extends</span> ReflectionColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Uses the normal direction instead of
reflection direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = EnvMap.Sample( MyShader.Normal );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//Dots the
Normal direction with the camera direction, and uses that<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<span
style='mso-tab-count:1'>    </span>value to blend between the two colors in the
given span.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> ReflectiveTwoTone <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Blends between two colors based on angle
of the normal to the eye.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue BlendStart
&lt;description=&quot;Angles lower than this are fully LowColor.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IValue BlendEnd
&lt;description=&quot;Angles higher than this are fully HighColor.&quot;&gt;;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor LowColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor HighColor;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float</span> ReflectFactor = <span
style='color:blue'>dot</span>( MyShader.Normal, -MyShader.UnitDirToCamera );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float</span> BlendFactor = <span
style='color:blue'>smoothstep</span>( BlendStart.Value, BlendEnd.Value, <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>ReflectFactor );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>lerp</span>(
LowColor.Color, HighColor.Color, <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>BlendFactor.xxxx );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> UseNormalDirection <span
style='color:blue'>extends</span> ReflectiveTwoTone <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Does a reflective blend using the
reflection direction instead of the normal direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float</span> ReflectFactor <o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>= <span style='color:blue'>dot</span>(
MyShader.UnitReflectDir, MyShader.UnitDirToCamera );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> One <span style='color:
blue'>adds</span> IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A hard-coded 1&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float</span> Value = 1;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Zero <span
style='color:blue'>adds</span> IValue<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A hard-coded 0&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float</span> Value = 0;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Black <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;The hard-coded color black,
(0,0,0,0)&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = (0).xxxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> White <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;The hard-coded color white,
(1,1,1,1)&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = (1).xxxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>abstract</span><span
style='font-size:10.0pt;font-family:"Courier New"'> <span style='color:blue'>modifier</span>
IColorCombiner<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> Combine(<span
style='color:blue'>float4</span> a, <span style='color:blue'>float4</span> b) =
a * b;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> CombinedTexture <span
style='color:blue'>adds</span> IColorCombiner, ITexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Combines two textures (feel free to stack
these). Multiplies them by default, modifiers can be added to change
this.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ITexture First;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> ITexture Second;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> BaseSample(<span style='color:blue'>float2</span>
coord)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span>= Combine( First.Sample(coord), Second.Sample( coord ) );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> CombinedColor <span
style='color:blue'>adds</span> IColorCombiner, IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Combines two colors (feel free to stack
these). Multiplies them by default, modifiers can be added to change
this.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor First;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> IColor Second;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = Combine( First.Color, Second.Color );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>modifier</span><span
style='font-size:10.0pt;font-family:"Courier New"'> AdditiveCombine <span
style='color:blue'>extends</span> IColorCombiner<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Changes a combiner into an additive
combiner i.e. First + Second.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Combine(<span style='color:blue'>float4</span>
a, <span style='color:blue'>float4</span> b) = a + b;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//These classes
are used for testing, and can be quite handy:<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_FlatLights <span
style='color:blue'>adds</span> IColor<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Just adds the lights colors, ignores
thier directions.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>app</span> ILight[] ColoredLights;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>float4</span> LightContrib(ILight el)<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>float</span> f = el.ClipFactor(
1 );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
2'>            </span><span style='color:blue'>return</span> el.Color * f;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = <span style='color:blue'>sumeach</span>(
LightContrib(<span style='color:blue'>value</span>) <span style='color:blue'>in</span>
ColoredLights );<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_ViewNormal <span
style='color:blue'>adds</span> IColor <span style='color:blue'>usedby</span>
MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Visualizes the normal as a color.
Reverses the Z direction for convenience.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = ( MyShader.Normal * <span
style='color:blue'>float3</span>(1,1,-1) ).xyz0;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_ViewTexCoords <span
style='color:blue'>adds</span> ITexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Outputs the texture coordinates as a
color so that you can easily visualize them.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>protected</span> <span style='color:blue'>float4</span>
BaseSample(<span style='color:blue'>float2</span> coord) = <span
style='color:blue'>frac</span>( coord ).xy00;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_EasyLight <span
style='color:blue'>adds</span> ILight<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;A directional white light in the
'LIGHT_0_DIR' direction.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>user</span> <span style='color:blue'>float3</span>
LightDirection : LIGHT_0_DIR;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float3</span> Direction = LightDirection;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Color = (1).xxxx;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:blue'>class</span><span
style='font-size:10.0pt;font-family:"Courier New"'> Test_ViewCubicCoords <span
style='color:blue'>adds</span> ICubicTexture<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span>&lt;description=&quot;Outputs the texture coordinates as a
color so that you can easily visualize them.&quot;&gt;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>      </span><span style='color:blue'>override</span> <span
style='color:blue'>float4</span> Sample(<span style='color:blue'>float3</span>
coord) = <span style='color:blue'>normalize</span>(coord).xyz0;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>//Don't use
this:<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>/*<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><span
style='mso-tab-count:1'>      </span>NOTE: Using this modifier, and setting
NewPosition to a UVCoord<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><span
style='mso-tab-count:1'>      </span>created a valid shader but made the driver
go crazy.<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>modifier
Test_CoordToPosition extends MyShader<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>{<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><span
style='mso-tab-count:1'>      </span>user IValue2 NewPosition;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><span
style='mso-tab-count:1'>      </span>override float4 FinalPosition =
NewPosition.Value.xy01;<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'>}<o:p></o:p></span><br/>

<span
style='font-size:10.0pt;font-family:"Courier New";color:green'><o:p>&nbsp;</o:p></span><br/>

<p class=MsoNormal><span style='font-size:10.0pt;font-family:"Courier New";
color:green'>*/</span><br/>


				</td>
			</tr>
		</table>
		<P>&nbsp;<br/>
		<P>&nbsp;<br/>
		<P>Copyright 2006 Lewey Geselowitz<br/>
	</body>
</html>
<!-- text below generated by server. PLEASE REMOVE --><!-- Counter/Statistics data collection code --><script language="JavaScript" src="http://l.yimg.com/d/lib/smb/js/hosting/cp/js_source/whv2_001.js"></script><script language="javascript">geovisit();</script><noscript><img src="http://visit.webhosting.yahoo.com/visit.gif?us1378800244" alt="setstats" border="0" width="1" height="1"></noscript>
